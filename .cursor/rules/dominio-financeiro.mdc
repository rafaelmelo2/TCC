---
description: Regras específicas para dados financeiros intradiários, custos de transação, validação temporal e backtests
globs: **/*.py
alwaysApply: false
---

# Regras do Domínio Financeiro

## Dados Intradiários
- Respeitar horários de pregão da B3 (10:00 às 17:00, horário de Brasília)
- Considerar periodicidade intradiária (picos na abertura/fechamento)
- Remover barras com volume zero ou preços anômalos (spikes espúrios)

## Custos de Transação
- Incluir custos fixos (corretagem) e proporcionais (emolumentos)
- Aplicar slippage realista (0.05% a 0.1% do valor negociado)
- Calcular custos conforme estrutura da B3

## Validação Temporal
- **NUNCA** embaralhar dados (shuffle) - viola ordem temporal
- Usar `TimeSeriesSplit` do scikit-learn ou implementação customizada
- Manter embargo temporal (h = horizonte de previsão, geralmente 1 barra)

## Backtests
1. Incluir custos realistas: corretagem, emolumentos, slippage
2. Testar estratégias: Long-only e long/short
3. Calcular métricas financeiras: Retorno, Sharpe, drawdown, turnover
4. Análise de sensibilidade: Variações de custos e thresholds
5. Documentar suposições: Explicar regras de entrada/saída

## Bibliotecas e Versões
- Python >= 3.10
- pandas >= 2.0.0, numpy >= 1.24.0, tensorflow >= 2.14.0
- scikit-learn >= 1.3.0, statsmodels >= 0.14.0
- **Gerenciador e Execução**: Usar `uv` para TUDO (instalar pacotes E executar código)
- Instalar: `uv pip install -r requirements.txt` ou `uv sync`
- Executar: `uv run python script.py` (NUNCA usar `python` diretamente)
